{
  "hash": "758f2c65b32df827887f37a2a07325bb",
  "result": {
    "markdown": "---\ntitle: \"Programming\"\nauthor: \"Rich Harris\"\ndate: '2022-07-11'\noutput: html_document\n---\n\n\n\n\n\n## Programming in R\n\nSo far in this course we have been cutting and pasting from these webpages into the Console of R Studio. Working in the Console is useful if you want to work with code on a line-by-line basis -- sometimes it is helpful to see if something will work; to try things out. However, in practice, it is better to write and work with more reproducible code, either for your own benefit so you can modify something without having entirely to start-over, or for the benefit of others who would like to reproduce your work. Reproducibility is an important component of open research and is to be encouraged wherever possible.\n\n## Scripts\n\nA script is a text file containing a sequence of commands that can be run together, one after the other, without entering them separately in the Console. Let's download an example of a script:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndownload.file(\"https://github.com/profrichharris/profrichharris.github.io/raw/main/MandM/scripts/script1.R\",\n              \"script1.R\", mode = \"wb\", quiet = TRUE)\n```\n:::\n\n\nYou can now use `file.edit(\"script1.R\") ` to view its contents. It should look like this:\n\n![](script1.png)\n\n</br>\nThe script is based on the opening parts of [Geographic Data in ipumsr](https://cran.r-project.org/web/packages/ipumsr/vignettes/ipums-geography.html){target=\"_blank\"}, where [ipumsr](https://cran.r-project.org/web/packages/ipumsr/index.html){target=\"_blank\"} provides \"an easy way to import census, survey and geographic data provided by 'IPUMS' into R\", and [IPUMS](https://www.ipums.org/){target=\"_blank\"} \"provides census and survey data from around the world integrated across time and space.\" I have modified their code for greater consistency with other parts of this course but what it does is largely the same:\n\n- It loads some example data and manipulates it to calculate the percentages of people using solid fuels for cooking in regions of Colombia at three time periods. These are the attribute data\n- It loads a geographic boundary file of those regions. This is the map.\n- It simplifies (reduces the detail of) the map to make it faster for plotting.\n- It joins the attribute data to the map by means of their common geography.\n- It produces a choropleth map (thematic map) of the geographic variation in the percentages using solid fuel.\n- It saves the spatially joined data as a shapefile.\n\nIf you now click within the window of the script and use command-A (Mac) or ctrl-A (Windows) to select all the code, followed by command-Enter/Return (Mac) or ctrl-Enter/Return (Windows) -- or use the Run button towards the top-right of the script window -- then the script will run in its entirety and should, at its conclusion, produce the following maps.\n\n![](hazard.gif){width=75}\n\n<font size = 3>Be patient whilst the code takes a few moments to run.</font>\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](markdown_example_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nTry also typing `source(\"script1.R\", echo = TRUE)` into the R Console. Again, the script should run in its entirety.\n\nAs suggested earlier, an advantage of using a script is that it is easy to make changes to and then re-run it either in part or in full. In the script, find the `type = \"cartolight\"` argument in the line that says `annotation_map_tile(type = \"cartolight\", progress = \"none\") +` and change the `type` to any other of the following, such as cartodark.\n\n### To Do\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrosm::osm.types()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"osm\"                    \"opencycle\"              \"hotstyle\"              \n [4] \"loviniahike\"            \"loviniacycle\"           \"hikebike\"              \n [7] \"hillshade\"              \"osmgrayscale\"           \"stamenbw\"              \n[10] \"stamenwatercolor\"       \"osmtransport\"           \"thunderforestlandscape\"\n[13] \"thunderforestoutdoors\"  \"cartodark\"              \"cartolight\"            \n```\n:::\n:::\n\n\nIf you wish to view what the different types look like, [you can do so here](http://leaflet-extras.github.io/leaflet-providers/preview/index.html){target=\"_blank\"}.\n\nOnce you have made the change, select the parts of the script you wish to rerun (everything under Map the data should be sufficient) and press the Run button or hit command-Enter/Return (Mac) or ctrl-Enter/Return (Windows) to execute the selected code.\n\n### A note about the `::` notation\n\nThe use of the `::` notation in the code `rosm::osm.types()` allows a function to be run from a package that has not been loaded. In the example, `osm.types` is a function in the `rosm` package. That package provides access to Open Steet Map and other maps tiles. We could also `require(rosm)` and then use the function directly as we have in other cases, i.e. using `osm.types()` instead of `rosm::osm.types()`. However, sometimes, if a function only is to be used once then there is no need to require the whole package. Also, sometimes we load multiple packages that have functions within them that share the same name and could conflict with each other. In such circumstances, the `package::function` format may be required to make sure the correct function (from the correct package) is being called.\n\n## R markdown\n\nScripts are useful but sometimes we wish to author documents that combine written text such as this with executable R code and its outputs and to publish them as html, pdf or Word documents. This is where [R Markdown](https://rmarkdown.rstudio.com/lesson-1.html){target=\"_blank\"} is useful.\n\nFrom the dropdown menus, select File -> New File -> R Markdown. Create the document in html format and give it any title you like.\n\n![](markdown.jpg)\n\nAfter R Studio has created the document, **Knit** it. The first time you do this, you will be asked to save the document - call it markdown1.Rmd or any other name you prefer.\n\n![](knit.jpg)\n\nIt is self-evident what knitting the document does -- it produce an html file which includes the text and formatting, the R code (unless suppressed with `echo = FALSE`) and output from that code. It also includes the option to publish the document on [RPubs](https://rpubs.com/) (although I suggest you don't do this now).\n\n![](publish.jpg)\n\n</br>\nThis whole course is written based on R Markdown. You can download the markdown file for this session\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndownload.file(\"https://github.com/profrichharris/profrichharris.github.io/raw/main/MandM/markdown/programming.Rmd\", \"markdown_example.Rmd\", mode = \"wb\", quiet = TRUE)\n```\n:::\n\n\nand view it using `file.edit(\"markdown_example.Rmd\")`. You may note that it begins with a YAML header, to which various arguments can be added or changed -- [see here](https://zsmith27.github.io/rmarkdown_crash-course/lesson-4-yaml-headers.html){rarget=\"_blank\"} for an introduction.\n\n\n\n````default\n---\ntitle: \"Programming\"\nauthor: \"Rich Harris\"\ndate: '2022-07-11'\noutput: html_document\n---\n````\n\n\nIt then consists of a mixture of text and code chunks. Those code chunks can be executed within the document using the Run drop-down menus and buttons.\n\n![](markdown2.jpg){}\n\n</br>\nThe document also includes various syntax, including `##header` for a header, `**bold**` for **bold**, `![](image.png)` to insert an existing image file, and so forth. To learn more, see the [R Markdown cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf){target=\"_blank\"}.\n\n### The source code for this document\n\nThis page has actually been authored in a variant of R markdown, using [quarto](https://quarto.org/){target=\"_blank\"}. You can view the source code for this and other pages using View Source from the drop-down Code options at the top of the page.\n\n![](source.jpg)\n\n## Summary\n\nAlthough a lot of what we will do in this course will involve cutting and pasting into the Console, keep in mind that there are better ways of programming that are more reproducible than entering commands one at a time into the Console. These include scripting and using markdown. Note also that as commands are entered into the Console, they are saved in the History to the top right of the screen. All or part of that history can be selected and moved to a source file (a new R Script) as the following shows. The history can also be saved -- see `?save.history()`.\n\n![](hist.png)\n\n## Further reading\n\n![](efficient_programming.png){width=150}\n\nThe book, Efficient R programming by Colin Gillespie and Robin Lovelace has an [online version here](https://csgillespie.github.io/efficientR/){target=\"_blank\"}.\n\nMore about R Markdown can be learned from [https://rmarkdown.rstudio.com/](https://rmarkdown.rstudio.com/){target=\"_blank\"}.\n",
    "supporting": [
      "markdown_example_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
?sample
x <- municipal$No_schooling
n <- length(municipal$No_schooling)
x <- municipal$No_schooling
n <- length(municipal$No_schooling)
lapply(1:100, \() {
sample(municipal$No_schooling, n) %>%
cor(lag.listw(spweight, .), .)
})
sample(municipal$No_schooling, n)
sample(municipal$No_schooling, n) %>%
lag.listw(spweight, .)
x <- municipal$No_schooling
n <- length(municipal$No_schooling)
lapply(1:100, \() {
sample(municipal$No_schooling, n) %>%
cor(. ~ lag.listw(spweight, .))
)
lapply(1:100, \() {
sample(municipal$No_schooling, n) %>%
cor(. ~ lag.listw(spweight, .))
})
lapply(1:100, \() {
sample(municipal$No_schooling, n) %>%
cor(., lag.listw(spweight, .))
})
lapply(1:100, \() {
x <- sample(municipal$No_schooling, n)
cor(x, lag.listw(spweight, x))
})
x <- sample(municipal$No_schooling, n)
x
?cor
cor(x, lag.listw(spweight, x))
lapply(1:100, \() {
x <- sample(municipal$No_schooling, n)
cor(x, lag.listw(spweight, x))
})
n <- length(municipal$No_schooling)
lapply(1:100, \(z) {
x <- sample(municipal$No_schooling, n)
cor(x, lag.listw(spweight, x))
})
lapply(1:100, \(x) {
sample(municipal$No_schooling, n) %>%
cor(., lag.listw(spweight, .))
})
sapply(1:100, \(x) {
sample(municipal$No_schooling, n) %>%
cor(., lag.listw(spweight, .))
})
sapply(1:100, \(x) {
sample(municipal$No_schooling, n) %>%
cor(lag.listw(spweight, .))
}) %>%
quantile(prob = c(0.025, 0.975))
n <- length(municipal$No_schooling)
sapply(1:100, \(x) {
sample(municipal$No_schooling, n) %>%
cor(., lag.listw(spweight, .))
}) %>%
quantile(prob = c(0.025, 0.975))
n <- length(municipal$No_schooling)
sapply(1:1000, \(x) {
sample(municipal$No_schooling, n) %>%
cor(lag.listw(spweight, .))
}) %>%
quantile(prob = c(0.025, 0.975))
pearson
?sample
n <- length(municipal$No_schooling)
sapply(1:1000, \(x) {
sample(municipal$No_schooling, n, replace = TRUE) %>%
cor(lag.listw(spweight, .))
}) %>%
quantile(prob = c(0.025, 0.975))
n <- length(municipal$No_schooling)
sapply(1:1000, \(x) {
sample(municipal$No_schooling, n, replace = TRUE) %>%
cor(lag.listw(spweight, .))
}) %>%
quantile(prob = c(0.025, 0.975))
n <- length(municipal$No_schooling)
sapply(1:1000, \(x) {
sample(municipal$No_schooling, n, replace = TRUE) %>%
cor(lag.listw(spweight, .))
}) %>%
quantile(prob = c(0.025, 0.975))
n <- length(municipal$No_schooling)
sapply(1:1000, \(x) {
sample(municipal$No_schooling, n, replace = TRUE) %>%
cor(lag.listw(spweight, .))
}) %>%
quantile(prob = c(0.025, 0.975))
if(!("GWmodel" %in% installed)) install.packages("GWmodel", dependencies = TRUE)
require(GWmodel)
?gw.ss
?gwss
names(municipal)
gwss(municipal, vars = c("No_schooling"), bw = 30)
coords
?sp
?SpatialPointsDataFrame
as_Spatial(municipal)
municipal_sp <- as_Spatial(municipal)
class(municipal_sp)
names(municipal_sp)
gwss(municipal_sp, vars = c("No_schooling"), bw = 30)
muncipal_sp
summary(municipal_sp)
tmp <- gwss(municipal_sp, vars = c("No_schooling"), bw = 30)
tmp
tmp$SDF
municipal_sp$No_schooling_lag <- lag.listw(spweight, municipal$No_schooling)
tmp <- gwss(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 30)
?lag.listw
tmp <- gwss(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 30, longlat = TRUE)
tmp
tmp <- gwss(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 30, adaptive = TRUE, longlat = TRUE)
municipal_sp <- as_Spatial(municipal)
municipal_sp <- CRS(SRS_string = "EPSG:4326")
municipal_sp$No_schooling_lag <- lag.listw(spweight, municipal$No_schooling)
tmp <- gwss(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 30, adaptive = TRUE, longlat = TRUE)
municipal_sp <- as_Spatial(municipal)
municipal_sp <- CRS(SRS_string = "EPSG:4326")
lag.listw(spweight, municipal$No_schooling)
municipal_sp$No_schooling_lag <- lag.listw(spweight, municipal$No_schooling)
class(muncipal_sp)
class(municipal_sp)
CRS(SRS_string = "EPSG:4326")
?crs
?CRS
CRS("+init=epsg:26978")
slot(municipal_sp, "proj4string") <- CRS("+init=epsg:26978")
?as_Spatial
municipal_sp <- as_Spatial(municipal)
municipal_sp$No_schooling_lag <- lag.listw(spweight, municipal$No_schooling)
tmp <- gwss(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 30, adaptive = TRUE, longlat = TRUE)
tmp
tmp$SDF
gwstats <- gwss(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 30, adaptive = TRUE, longlat = TRUE)
gwstats$SDF
names(gwstats$SDF)
gwstats$SDF$"Corr_No_schooling.No_schooling_lag"
gwcor
gwcor <- gwstats$SDF$"Corr_No_schooling.No_schooling_lag"
gwcor
municipal$gwcor <- gwstats$SDF$"Corr_No_schooling.No_schooling_lag"
ggplot(data = municipal, aes(fill = Corr_No_schooling.No_schooling_lag)) +
geom_sf() +
scale_fill_brewer("%", palette = "RdYlBu", direction = -1) +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = "Corr_No_schooling.No_schooling_lag")) +
geom_sf() +
scale_fill_brewer("%", palette = "RdYlBu", direction = -1) +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = `Corr_No_schooling.No_schooling_lag`)) +
geom_sf() +
scale_fill_brewer("%", palette = "RdYlBu", direction = -1) +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
names(municipal)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_brewer("%", palette = "RdYlBu", direction = -1) +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_continuous() +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
?scale_fill_gradient2
?scale_fill_brewer
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_brewer() +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_distiller() +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_distiller(palette = "RdYlBu", direction = -1) +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_continuous(palette = "RdYlBu", direction = -1) +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_continuous(palette = "RdYlBu") +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
?scale_fill_continuous
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_gradient() +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_continuous() +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_y_continuous() +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
class(municipal_sp$gwcor)
class(municipal$gwcor)
summary(municipal$gwcor)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_continuous() +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_distiller() +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_distiller(pallete = "RdYlBu") +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_distiller(palette = "RdYlBu") +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
gwstats
gwstats$SDF
names(gwstats$SDF)
?gwss.montecarlo
data(LondonHP)
DM<-gw.dist(dp.locat=coordinates(londonhp))
test.lss<-gwss.montecarlo(data=londonhp, vars=c("PURCHASE","FLOORSZ"), bw=5000,
kernel ="gaussian", dMat=DM,nsim=99)
test.lss
test.lss$SDF
test.lss
names(test.lss)
row.names(test.lss)
col.names(test.lss)
colnames(test.lss)
head(test.lss)
p_values <- gwss.montecarlo(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 30, adaptive = TRUE, longlat = TRUE)
p_values
head(p_values)
p_values$Corr_No_schooling.No_schooling_lag
colnames(p_values)
j <- which(colnames(p_values == "Corr_No_schooling.No_schooling_lag"))
j <- which(colnames(p_values) == "Corr_No_schooling.No_schooling_lag")
j
p_values[,j]
p_values <- p_values[,j]
municipal$gwcor[p_values < 0.95] <- NA
last_plot()
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_distiller(palette = "RdYlBu") +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
p_values <- gwss.montecarlo(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 10, adaptive = TRUE, longlat = TRUE)
j <- which(colnames(p_values) == "Corr_No_schooling.No_schooling_lag")
p_values <- p_values[,j]
municipal$gwcor[p_values < 0.90] <- NA
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_distiller(palette = "RdYlBu") +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
municipal$gwcor <- gwstats$SDF$"Corr_No_schooling.No_schooling_lag"
p_values <- p_values[,j]
municipal$gwcor[p_values > 0.05] <- NA
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_distiller(palette = "RdYlBu") +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
p_values
head(pvalues)
head(p_values)
p_values <- gwss.montecarlo(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 10, adaptive = TRUE, longlat = TRUE)
colnames(p_values)
names(gwss$SDF)
names(gwstats$SDF)
plot(gwstats$SDF[,12], p_values[,12])
p_values[,12])
p_values[,12]
gwstats$SDF[,12]
head(gwstats$SDF)
gwstats$SDF[,1]
class(gwstats$SDF[,1])
as.numeric(gwstats$SDF[,1])
plot(gwstats$SDF$Corr_No_schooling.No_schooling_lag, p_values[,12])
?gwss.montecarlo
p_values <- gwss.montecarlo(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 10, adaptive = TRUE, longlat = TRUE)
j <- which(colnames(p_values) == "Corr_No_schooling.No_schooling_lag")
p_values <- p_values[,j]
municipal$gwcor[p_values < 0.025 | p_values > 0.975] <- NA
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_distiller(palette = "RdYlBu") +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
?gwss.montecarlo
p_values <- gwss.montecarlo(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 10, adaptive = TRUE, longlat = TRUE, nsim = 999)
j <- which(colnames(p_values) == "Corr_No_schooling.No_schooling_lag")
p_values <- p_values[,j]
municipal$gwcor[p_values < 0.025 | p_values > 0.975] <- NA
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_distiller(palette = "RdYlBu") +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
?poly2nb
moran
p_values <- gwss.montecarlo(municipal_sp, vars = c("No_schooling", "No_schooling_lag"), bw = 10, adaptive = TRUE, longlat = TRUE, nsim = 999)
j <- which(colnames(p_values) == "Corr_No_schooling.No_schooling_lag")
p_values <- p_values[,j]
municipal$gwcor[p_values < 0.025 | p_values > 0.975] <- NA
ggplot(data = municipal, aes(fill = gwcor)) +
geom_sf() +
scale_fill_distiller(palette = "RdYlBu") +
theme_minimal() +
theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
labs(
title = "Percentage of Population with No Schooling",
subtitle = "2011 South African Census Data",
caption = "Source: Statistics South Africa"
)
k
knearneigh(coords, k, longlat = TRUE) %>%
knn2nb %>%
nb2listw %>%
moran.test(municipal$No_schooling, .) ->
moran
moran
names(moran)
names(moran$p.value)
moran$p.value
n <- nrow(municipal)
y <- lapply(1: (n-1), \(k) {
knearneigh(coords, k, longlat = TRUE) %>%
knn2nb %>%
nb2listw %>%
moran.test(municipal$No_schooling, .) ->
moran
c(moran$estimate[1], moran$p.value)
})
y
boot <- bootstrap(mtcars, 100)
require(purrr)
boot <- bootstrap(mtcars, 100)
require(purr)
?purr::bootstrap
?purrr::bootstrap
library(purrr)
boot <- bootstrap(mtcars, 100)
require(modelr)
library(purrr)
boot <- bootstrap(mtcars, 100)
boot
models <- map(boot$strap, ~ lm(mpg ~ wt, data = .))
models
?map
boot <- bootstrap(municipal$No_schooling, 100)
map(boot$strap, ~ cor(lag.listw(spweight, .)))
boot$strap
boot <- bootstrap(municipal$No_schooling, 100)
map(boot$strap, ~ cor(lag.listw(spweight, boot$strap)))
map(boot$strap, ~ cor(lag.listw(spweight)))
map(boot$strap, ~ cor(lag.listw(spweight, boot$strap)))
getwd()
setwd("C:/Users/profr/Dropbox/github/MandM")
install.packages("cowplot")
install.packages("cartogram")
install.packages("lpSolve")

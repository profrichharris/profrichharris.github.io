---
title: "Programming"
author: "Rich Harris"
date: '2022-07-11'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Programming in R

So far in this course we have been cutting and pasting from these webpages into the Console of R Studio. Working in the Console is useful if you want to work with code on a line-by-line basis -- sometimes it is helpful to see if something will work; to try things out. However, in practice, it is better to write and work with more reproducible code, either for your own benefit so you can modify something without having entirely to start-over, or for the benefit of others who would like to reproduce your work. Reproducibility is an important component of open research and is to be encouraged wherever possible.

## Scripts

A script is a text file containing a sequence of commands that can be run together, one after the other, without entering them separately in the Console. Here is an example of a script:

```{r, eval=FALSE}
download.file("https://github.com/profrichharris/profrichharris.github.io/raw/main/MandM/scripts/script1.R",
              "script1.R", mode = "wb", quiet = TRUE)
file.edit("script1.R")  # You can also use File -> Open to open the file
```

It should look something like this:

![](script1.png)

</br>
The script is based on the opening parts of [Geographic Data in ipumsr](https://cran.r-project.org/web/packages/ipumsr/vignettes/ipums-geography.html){target="_blank"}, where [ipumsr](https://cran.r-project.org/web/packages/ipumsr/index.html){target="_blank"} provides "an easy way to import census, survey and geographic data provided by 'IPUMS' into R", and [IPUMS](https://www.ipums.org/){target="_blank"} "provides census and survey data from around the world integrated across time and space." I have modified their code for greater consistency with other parts of this course but what it does is largely the same:

- It loads some example data and manipulates it to calculate the percentages of people using solid fuels for cooking in regions of Colombia at three time periods. These are the attribute data
- It loads a geographic boundary file of those regions. This is the map.
- It simplifies (reduces the detail of) the map to make it faster for plotting.
- It joins the attribute data to the map by means of their common geography.
- It produces a choropleth map (thematic map) of the geographic variation in the percentages using solid fuel.
- It saves the spatially joined data as a shapefile.

If you now click within the window of the script and use command-A (Mac) or ctrl-A (Windows) to select all the code, followed by command-Enter/Return (Mac) or ctrl-Enter/Return (Windows) -- or use the Run button towards the top-right of the script window -- then the script will run in its entirety and should, at its conclusion, produce the following maps.

![](hazard.gif){width=75}

<font size = 3>Be patient whilst the code takes a few moments to run.</font>

```{r, echo=FALSE, eval=TRUE, warning=FALSE, message=FALSE, fig.height=4.5}
download.file("https://github.com/profrichharris/profrichharris.github.io/raw/main/MandM/scripts/script1.R", "script1.R", mode = "wb", quiet = TRUE)
source("script1.R", echo = FALSE, print.eval = TRUE)
```

Try also typing the following into the Console:

```{r, eval=FALSE}
source("script1.R", echo = TRUE)
```

Again, the script should run in its entirety.

As suggested earlier, an advantage of using a script is that it is easy to make changes to and then re-run it either in part or in full. In the script, find the `type = "cartolight"` argument in the line that says `annotation_map_tile(type = "cartolight", progress = "none") +` and change the `type` to any other of the following, such as cartodark.

```{r}
rosm::osm.types()
```

If you wish to view what the different types look like, [you can do so here](http://leaflet-extras.github.io/leaflet-providers/preview/index.html){target="_blank"}.

Once you have made the change, select the parts of the script you wish to rerun (everything under Map the data should be sufficient) and press the Run button or hit command-Enter/Return (Mac) or ctrl-Enter/Return (Windows) to execute the selected code.

### A note about the `::` notation

The use of the `::` notation in the code `rosm::osm.types()` allows a function to be run from a package that has not been loaded. In the example, `osm.types()` is a function in the `rosm` package. That package provides access to Open Steet Map and other maps tiles. We could also `require(rosm)` and then use the function directly as we have in other cases, i.e. using `osm.types()` instead of `rosm::osm.types()`. However, sometimes, if a function only is to be used once then there is no need to require the whole package. Also, sometimes we load multiple packages that have functions within them that share the same name. In such circumstances, the `package::function` format may be required to make sure the correct function (from the correct package) is being called.

## R markdown

Scripts are useful but sometimes we wish to author documents that combine written text such as this with executable R code and its outputs and to publish them as html, pdf or Word documents. This is where [R Markdown](https://rmarkdown.rstudio.com/lesson-1.html){target="_blank"} is useful.

From the dropdown menus, select File -> New File -> R Markdown. Create the document in html format and give it any title you like.

![](markdown.jpg)

After R Studio has created the document, **Knit** it. The first time you do this, you will be asked to save the document - call it markdown1.Rmd or any other name you prefer.

![](knit.jpg)

It is self-evident what knitting the document does -- it produce an html file which includes the text and formatting, the R code (unless suppressed with `echo = FALSE`) and output from that code. It also includes the option to publish the document on [RPubs](https://rpubs.com/) (although I suggest you don't do this now).

![](publish.jpg)

This whole course is written based on R Markdown. The markdown file for this session can be viewed as follows.

```{r}
download.file("https://github.com/profrichharris/profrichharris.github.io/raw/main/MandM/scripts/script1.R",
              "script1.R", mode = "wb", quiet = TRUE)
file.edit("programming.Rmd")  
```


